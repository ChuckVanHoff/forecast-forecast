#!/bin/sh
# set up proxy if needed
#export HTTP_PROXY="YOUR_PROXY_ADDRESS"
#export HTTPS_PROXY="YOUR_PROXY_ADDRESS"
# Install required packages 
sudo yum install -y zlib-devel openssl-devel bzip2-devel xz-devel
PWD=$(pwd)
py_ver=3.6.9
#python_dir=/home/mvanorde/portapy-${py_ver} 
mkdir "python_dir" 
# Build python
wget -O- https://www.python.org/ftp/python/${py_ver}/Python-${py_ver}.tgz | tar xz
cd "${PWD}/Python-${py_ver}/"
./configure --prefix=${python_dir} && make && make install
# Build setuptools
url=$(curl -s 'https://pypi.org/project/setuptools/#files'|grep -Eo 'https://\S+.zip') 
cd "$PWD" 
wget -O- "$url" | jar x 
cd "${PWD}/$(echo "$url" | grep -Eo '\w+-([0-9]+\.){2}[0-9]+')" 
${python_dir}/bin/python3 ./setup.py install 
# Build pip
url=$(curl -s 'https://pypi.org/project/pip/#files'|grep -Eo 'https://\S+.gz')
cd "${PWD}"
wget -O- "${url}" | tar xz
cd "${PWD}/$(echo "$url" | grep -Eo '\w+-([0-9]+\.){2}[0-9]+')"
${python_dir}/bin/python3 ./setup.py install
cd ..
# Install virtualenv
${python_dir}/bin/pip install virtualenv pandas matplotlib
# Create a tar of the portable python install
cd ${python_dir}/..
file=$(echo $python_dir | rev | cut -d'/' -f1 | rev)
tar czf "${file}.tar.gz" "${file}"